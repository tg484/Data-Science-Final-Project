---
title: "Final Project_EDA"
author: "Priyasha Chawla"
date: "24/04/2022"
output: html_document
---

``````{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(tidymodels)
library(themis)
library(rpart.plot)
library(vip)
library(parsnip)
library(dials)
library(ranger)
library(ggplot2)
library(plotrix)
```

```{r cleaning}
# load the data
voting_data <- read_csv("CES20_Common_OUTPUT_vv.csv") %>%
  select(CC20_401, birthyr, gender, educ, race, CC20_332a, CC20_302, CC20_309e, CC20_350b, urbancity, ideo5, pew_religimp, ownhome,newsint, faminc_new, investor, internethome, sexuality, CC20_331e, gunown, child18, votereg, presvote16post, CC20_303, CC20_307, employ, marstat, immstat, phone, CC20_300_1,CC20_300_2, CC20_300_3, CC20_300_4, CC20_300_5, CC20_300a, CC20_300c , CC20_320d, CC20_320b, race, inputstate, CC20_430a_1, CC20_430a_2, CC20_430a_3, CC20_430a_4, CC20_430a_5, CC20_430a_6, CC20_430a_7)

# create age variable, filter registered voters and drop missing values
voting_data <- voting_data %>%
  mutate(birthyr = 2020 - birthyr) %>%
  filter(votereg == 1) %>%
  na.omit()

# recode internet at home to match implemtation data
voting_data <- voting_data %>%
  mutate(internethome = if_else(condition = internethome <= 2, true = 1,
                                false = 2))

# create a binary variable for voted or not and convert to factor
voting_data <- voting_data %>% 
    mutate(voted = if_else(condition = CC20_401 == 5, true = 1,
                               false = 0))%>%
  mutate(voted = factor(voted, labels = c("1", "0"), levels = c("1", "0")))

# drop voter registration (since it is a prerequiste, not a predictor)
voting_data <- voting_data %>% 
  select(-votereg)
```

###Descriptive statistics 
###Sample distribution by race 

```{r}
#Sample distribution by race
#Unique value for race variable
voting_data_race <- voting_data %>%
  group_by(race = as.factor(race)) %>%
  count() %>% 
  mutate(racepercent = n *100 /dim(voting_data)[1])

#Plotting sample distribution by race
Plot_race <- voting_data %>%
  group_by(race = as.factor(race)) %>%
  summarise(count = n())%>%
  mutate(frequency = (count/sum(count))*100)%>%
  ggplot(aes (x = race, y = frequency, fill = race)) +
  geom_col(stat = "identity", width = 0.7, position = "dodge") +
  geom_text(aes(label = round(frequency, digits = 2)), position = position_dodge(0.7),
            vjust = -0.5, size = 3) +
  theme_minimal() +
  scale_y_continuous(limits = c(0,100)) + 
  labs(title = "Sample distribution by race",
    caption ="Source: Harvard's Cooperative Election Study 2020",
    x = "Race", 
    y = "Percentage of Individuals",
    fill ="Race") +
  scale_x_discrete(labels = c())+
  scale_fill_brewer(palette="Dark2", labels = c("White", "Black/African-American", "Hispanic/Latino", "Asian/Asian-American", "Native American","Middle Eastern", "Two or more races", "Other", "Unknown"))

print(Plot_race)
```


More than 75% respondents in the Cooperative Election Study are White. Black/African- American and Hispanic/Latino respondents constitute only 16% of the total sample.

###Sample distribution by age

```{r}
#Sample distribution by age
#Unique value for birthyr variable
voting_data %>%
  group_by(birthyr) %>%
  count() 

#Making new variables for age-groups
voting_data <- voting_data %>%
  mutate(agegroup = case_when(birthyr >= 18  & birthyr <= 24 ~ '18_24',
                                             birthyr >= 25  & birthyr <= 34 ~ '25_34',
                                             birthyr >= 35  & birthyr <= 44 ~ '35_44',
                                             birthyr >= 45  & birthyr <= 54 ~ '45_55', 
                                             birthyr >= 55  & birthyr <=64 ~ '55_64',
                                             birthyr >= 64  & birthyr <= 74 ~ '64_74',
                                             birthyr >= 75  ~ '75+'))
voting_data %>%
  group_by(agegroup) %>%
  count() 

#Plotting age groups
Plot_age <- voting_data %>%
  group_by(agegroup = as.factor(agegroup)) %>%
  summarise(count = n())%>%
  mutate(frequency = (count/sum(count))*100)%>%
  ggplot(aes (x = agegroup, y = frequency, fill = agegroup)) +
  geom_col(stat = "identity", width = 0.7, position = "dodge") +
  geom_text(aes(label = round(frequency, digits = 2)), position = position_dodge(0.7),
            vjust = -0.5, size = 3) +
  theme_minimal() +
  scale_y_continuous(limits = c(0,100)) + 
  labs(title = "Sample distribution by age",
    caption ="Source: Harvard's Cooperative Election Study 2020",
    x = "Age Group", 
    y = "Percentage of Individuals",
    fill ="Age group") +
  scale_x_discrete(labels = c("18_24", "25_34","35_44", "45_55", "55_64", "64_74", "75+")) +
  scale_fill_brewer(palette="PuBuGn", labels = c("18-24", "25_34","35_44", "45_55", "55_64", "64_74", "75+"))
  
print(Plot_age)

```


Close to half of all the respondents fall in the age group of 45-64. The sample is primarily middle-aged. Only 2% of the respondents are youth between the age of 18-24.


###Sample distribution  by sexuality 
```{r}
##Sample distribution by sexuality
#Unique values for sexuality
voting_data %>%
  group_by(sexuality) %>%
  count() 

#Plotting sexuality distribution in sample
Plot_sex <- voting_data %>%
  group_by(sexuality = as.factor(sexuality)) %>%
  na.omit() %>%
  summarise(count = n())%>%
  mutate(frequency = (count/sum(count))*100)%>%
  ggplot(aes (x = sexuality, y = frequency, fill =sexuality)) +
  geom_col(stat = "identity", width = 0.7, position = "dodge") +
  geom_text(aes(label = round(frequency, digits = 2)), position = position_dodge(0.7),
            vjust = -0.5, size = 3) +
  theme_minimal() +
  scale_y_continuous(limits = c(0,100)) + 
  labs(title = "Sample distribution by sexuality",
    caption ="Source: Harvard's Cooperative Election Study 2020",
    x = "Sexuality", 
    y = "Percentage of Individuals",
    fill = "Sexuality") +
  scale_x_discrete(labels = c())+
  scale_fill_manual(values = c("#2166ac", "#67a9cf","#e0e0e0", "#ef8a62","#b2182b", "#ffffbf"), labels = c("Heterosexual/straight", "Lesbina/Gay woman","Gay man", "Bisexual", "Other", "Prefer not to say"))

print(Plot_sex)
```


Almost 88% of the respondents identify as Heterosexual/straight. The LGBTQI community constitutes less than 10% of the sample. 

###Sample distribution by gender
```{r}
##Sample distribution by gender
Plot_gen <- voting_data %>%
  group_by(gender = as.factor(gender)) %>%
  summarise(count = n())%>%
  mutate(frequency = (count/sum(count))*100) %>%
  ggplot(aes (x = gender, y = frequency, fill=gender)) +
  geom_col(stat = "identity", width = 0.7, position = "dodge") +
  geom_text(aes(label = round(frequency, digits = 2)), position = position_dodge(0.7),
            vjust = -0.5, size = 3)+
  theme_minimal() +
  scale_y_continuous(limits = c(0,100)) + 
  labs(title = "Sample distribution by gender",
    caption ="Source: Harvard's Cooperative Election Study 2020",
    x = "Gender", 
    y = "Percentage of Individuals",
    fill = "Gender") +
  scale_x_discrete(labels = c())+
  scale_fill_manual(values = c("#2166ac", "#67a9cf"), labels = c("Male", "Female"))

print(Plot_gen)
```


The sample distribution is inclusive when it comes to gender. It has an almost equal proportion of men and women.

#Sample distribution by education
```{r}
##Sample distribution by education
#Unique values for education
voting_data %>%
  group_by(educ) %>%
  count() 

#Plotting the distribution 
plot_edu <- voting_data %>%
  select(educ) %>%
  na.omit() %>%
  group_by(educ = as.factor(educ)) %>%
  summarise(count =  n()) %>%
  mutate(frequency = (count/sum(count))*100) %>%
  ggplot(aes(x = educ, y = frequency , fill = educ)) +
  geom_col(stat = "identity", width = 0.9, position = "dodge") + 
  geom_text(aes(label = round(frequency, digits = 2)), position = position_dodge(0.9),
            vjust = -0.7, size = 3) +
  scale_y_continuous(limits = c(0,100))+
  labs (title = "Sample distribution by education",
        x = "Highest level of education",
        y = "Percentage of Individuals",
        fill = "Highest level of education",
        caption = "Source: Harvard's Cooperative Election Study 2020") +
  theme_minimal() +
  scale_x_discrete(labels = c())+
  scale_fill_brewer(palette="PuBuGn", labels = c("Did not graduate from high school", "High school graduate", "Some college, but no degree (yet)", "2-year college degree", "4-year college degree", "Postgraduate degree"), direction = -1)

print(plot_edu)
```


30% of the sample is at least a four-year college graduate. 22% pf the respondents are postgraduates.Less than 10% of the respondents did not graduate from high school.

###Sample distribution by voting behaviour
```{r}
##Sample distribution by voting behaviour 
Plot_vot <- voting_data %>%
  group_by(voted = as.factor(voted)) %>%
  na.omit() %>%
  summarise(count =  n()) %>%
  mutate(frequency = (count/sum(count))*100) %>%
  ggplot(aes(x = voted, y = frequency , fill = voted)) +
  geom_col(stat = "identity", width = 0.9, position = "dodge") + 
  geom_text(aes(label = round(frequency, digits = 2)), position = position_dodge(0.9),
            vjust = -0.7, size = 3) +
  scale_x_discrete(labels = c("Voted", "Not Voted")) +
  scale_y_continuous(limits = c(0,100))+
  labs (title = "Sample distribution by voting behvaiour",
        x = "Voted in 2020 Election",
        y = "Percentage of Individuals",
        caption = "Source: Harvard's Cooperative Election Study 2020",
        fill = "Voting Behaviour") +
  theme_minimal()+
  scale_fill_manual(values = c("#2166ac", "#67a9cf"), labels = c("Voted", "Not voted"))

print(Plot_vot)
```


Close to 98% of all respondents said that they voted in the 2020 elections.

###Exploratory Data Analysis 
### Race distribution by voting behaviour

```{r Plot}
#Plotting race distribution by voting behaviour
Plot_vrace <- voting_data %>%
  select(voted, race) %>%
  na.omit() %>%
  group_by(voted = as.factor(voted), race = as.factor(race)) %>%
  summarise(count =  n()) %>%
  mutate(frequency = (count/sum(count))*100) %>%
  ggplot(aes(x = voted, y = frequency , fill = race)) +
  geom_col(stat = "identity", width = 0.9, position = "dodge") + 
  geom_text(aes(label = round(frequency, digits = 1)), position = position_dodge(0.9),
            vjust = -0.5, size = 2.6) +
  scale_x_discrete(labels = c("Voted", "Not Voted")) +
  scale_y_continuous(limits = c(0,100))+
  labs (title = "Race by Voting Behaviour",
        x = "Voted in 2020 Election",
        y = "Percentage of Individuals",
        fill = "Sexuality",
        caption = "Source: Harvard's Cooperative Election Study 2020") +
  theme_minimal() +
  scale_fill_brewer(palette="Set2", labels = c("White", "Black/African-American", "Hispanic/Latino", "Asian/Asian-American", "Native American","Middle Eastern", "Two or more races", "Other", "Unknown"), direction = -1)

print(Plot_vrace)
```


77.2% of the individuals who voted are White while only 63.8% of the individuals who did not vote are White. Among those who voted, almost 9% were Black/African-American. Blacks constitute a higher percentage of those who did not vote at 17.9%. Minority communities constitute a higher proportion of the group that did not vote as compared to those who did. 

#Age distribution by voting behaviour 

```{r}

#Plotting age distribution by voting behaviour 
Plot_vage <- voting_data %>%
  select(voted, agegroup) %>%
  na.omit() %>%
  group_by(voted = as.factor(voted), agegroup = as.factor(agegroup)) %>%
  summarise(count =  n()) %>%
  mutate(frequency = (count/sum(count))*100) %>%
  ggplot(aes(x = voted, y = frequency , fill = agegroup)) +
  geom_col(stat = "identity", width = 0.9, position = "dodge") + 
  geom_text(aes(label = round(frequency, digits = 2)), position = position_dodge(0.9),
            vjust = -0.5, size = 3) +
  scale_x_discrete(labels = c("Voted", "Not Voted")) +
  scale_y_continuous(limits = c(0,100))+
  labs (title = "Age Group by Voting Behaviour",
        x = "Voted in 2020 Election",
        y = "Percentage of Individuals",
        fill = "Age Group",
        caption = "Source: Harvard's Cooperative Election Study 2020") +
  theme_minimal() +
  scale_fill_brewer(palette="PuBuGn", labels = c("18_24", "25_34","35_44", "45_55", "55_64", "64_74", "75+"), direction = -1)
  
print(Plot_vage)                      
```


There is a higher proportion of middle-aged individuals among the group that voted than those who didn't. Almost 33% of those who did not vote are youth in the age group of 18 to 34. Youth's disengagement with voting activities in clear in the graph. Older age groups are more likely to vote. 

#Sexuality by voting behaviour  

```{r}
#Plotting sexuality by voting behaviour 
Plot_vsex <- voting_data %>%
  select(voted, sexuality) %>%
  na.omit() %>%
  group_by(voted = as.factor(voted), sexuality = as.factor(sexuality)) %>%
  summarise(count =  n()) %>%
  mutate(frequency = (count/sum(count))*100) %>%
  ggplot(aes(x = voted, y = frequency , fill = sexuality)) +
  geom_col(stat = "identity", width = 0.9, position = "dodge") + 
  geom_text(aes(label = round(frequency, digits = 2)), position = position_dodge(0.9),
            vjust = -0.5, size = 3) +
  scale_x_discrete(labels = c("Voted", "Not Voted")) +
  scale_y_continuous(limits = c(0,100))+
  labs (title = "Sexuality by Voting Behaviour",
        x = "Voted in 2020 Election",
        y = "Percentage of Individuals",
        fill = "Sexuality",
        caption = "Source: Harvard's Cooperative Election Study 2020") +
  theme_minimal() +
  scale_fill_brewer(palette="Set2", labels = c("Heterosexual/straight", "Lesbina/Gay woman","Gay man", "Bisexual", "Other", "Prefer not to say"))
  
print(Plot_vsex) 
```


Since the sample is dominated by individuals who identify as heterosexual/straight, the percentage of those who did not vote and well as those who did is majorly this group. Since LGBTQI community is not well-represented in this data set, it is hard to draw any conclusions about the correlation between sexuality and voting behaviour. 

#Employment by voting behaviour 
```{r}
#Unique values for employment 
voting_data %>%
  group_by(employ) %>%
  count() 

#Plotting employment by voting behaviour 
Plot_vemp <- voting_data %>%
  select(voted, employ) %>%
  na.omit() %>%
  group_by(voted = as.factor(voted), employ = as.factor(employ)) %>%
  summarise(count =  n()) %>%
  mutate(frequency = (count/sum(count))*100) %>%
  ggplot(aes(x = voted, y = frequency , fill = employ)) +
  geom_col(stat = "identity", width = 0.9, position = "dodge") + 
  geom_text(aes(label = round(frequency, digits =1)), position = position_dodge(0.9),
            vjust = -0.5, size = 2.8) +
  scale_x_discrete(labels = c("Voted", "Not Voted")) +
  scale_y_continuous(limits = c(0,100))+
  labs (title = "Employment Status by Voting Behaviour",
        x = "Voted in 2020 Election",
        y = "Percentage of Individuals",
        fill = "Employment status",
        caption = "Source: Harvard's Cooperative Election Study 2020") +
  theme_minimal() +
  scale_fill_brewer(palette="Set3", labels = c("Working full time", "Working part time","Temporarily laid off", "Unemployed", " Retired", "Permanently disabled", "Taking care of family", "Student", "Other"), direction = -1)
  
print(Plot_vemp) 
```

More than 71% of those who votes are individuals who work full time and those who are retired. Only 1.5% of those who voted were students. This underscores the poor engagement of youth with voting activities. It is expected that more unemployed individuals are likely to vote but only 5.3% of those who voted were unemployed. This number is 13.2% for the group that did not vote. 